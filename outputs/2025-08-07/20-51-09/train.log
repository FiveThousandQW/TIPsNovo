[2025-08-07 20:51:09,202][__main__][INFO] - Initializing training.
[2025-08-07 20:51:09,203][__main__][INFO] - Python version: 3.10.15 | packaged by conda-forge | (main, Oct 16 2024, 01:24:24) [GCC 13.3.0]
[2025-08-07 20:51:09,203][__main__][INFO] - Torch version: 2.4.1+cu121
[2025-08-07 20:51:09,203][__main__][INFO] - CUDA version: 12.1
[2025-08-07 20:51:09,207][__main__][INFO] - Imported hydra config:
train_path: /data/48/wuqian/fast/TipsNovo/data/tmp/test_128000dup.mgf
dim_model: 768
n_head: 16
dim_feedforward: 1024
n_layers: 9
dropout: 0.1
use_flash_attention: false
conv_peak_encoder: false
n_peaks: 200
min_mz: 50.0
max_mz: 2500.0
min_intensity: 0.01
remove_precursor_tol: 2.0
max_charge: 10
precursor_mass_tol: 50
isotope_error_range:
- 0
- 1
predict_batch_size: 32
max_length: 40
tb_summarywriter: /data/48/wuqian/fast/TipsNovo/log
warmup_iters: 480
max_iters: 3000000
learning_rate: 0.001
train_batch_size: 32
grad_accumulation: 1
weight_decay: 1.0e-05
gradient_clip_val: 10.0
n_beams: 5
compile_model: true
device: auto
n_gpu: 1
fp16: true
epochs: 1
num_sanity_val_steps: 10
console_logging_steps: 50
tensorboard_logging_steps: 500
report_to: null
run_name: instanovo_test
train_subset: 1.0
valid_subset: 1.0
val_check_interval: 1.0
lazy_loading: true
max_shard_size: 1000000
preshuffle_shards: true
perform_data_checks: true
validate_precursor_mass: false
verbose_loading: true
model_save_folder_path: /data/48/wuqian/fast/TipsNovo/model_save
save_model: true
save_weights_only: false
ckpt_interval: 480
train_from_scratch: true
resume_checkpoint: null
residues:
  G: 57.021464
  A: 71.037114
  S: 87.032028
  P: 97.052764
  V: 99.068414
  T: 101.04767
  C: 103.009185
  L: 113.084064
  I: 113.084064
  'N': 114.042927
  D: 115.026943
  Q: 128.058578
  K: 128.094963
  E: 129.042593
  M: 131.040485
  H: 137.058912
  F: 147.068414
  R: 156.101111
  'Y': 163.063329
  W: 186.079313
  M[UNIMOD:35]: 147.0354
  C[UNIMOD:4]: 160.030649
  N[UNIMOD:7]: 115.026943
  Q[UNIMOD:7]: 129.042594
  S[UNIMOD:21]: 166.998028
  T[UNIMOD:21]: 181.01367
  Y[UNIMOD:21]: 243.029329
  '[UNIMOD:1]': 42.010565
  '[UNIMOD:5]': 43.005814
  '[UNIMOD:385]': -17.026549

[2025-08-07 20:51:09,210][__main__][INFO] - Starting transformer training
[2025-08-07 20:51:09,210][__main__][INFO] - Vocab: {0: '[PAD]', 1: '[SOS]', 2: '[EOS]', 3: 'G', 4: 'A', 5: 'S', 6: 'P', 7: 'V', 8: 'T', 9: 'C', 10: 'L', 11: 'I', 12: 'N', 13: 'D', 14: 'Q', 15: 'K', 16: 'E', 17: 'M', 18: 'H', 19: 'F', 20: 'R', 21: 'Y', 22: 'W', 23: 'M[UNIMOD:35]', 24: 'C[UNIMOD:4]', 25: 'N[UNIMOD:7]', 26: 'Q[UNIMOD:7]', 27: 'S[UNIMOD:21]', 28: 'T[UNIMOD:21]', 29: 'Y[UNIMOD:21]', 30: '[UNIMOD:1]', 31: '[UNIMOD:5]', 32: '[UNIMOD:385]'}
[2025-08-07 20:51:09,210][__main__][INFO] - Loading data
[2025-08-07 20:51:09,211][instanovo.utils.data_handler][INFO] - Loading file 001 of 001: /data/48/wuqian/fast/TipsNovo/data/tmp/test_128000dup.mgf
[2025-08-07 20:51:53,813][instanovo.utils.data_handler][INFO] - Saving temporary file to /tmp/tmplo8k4j3l/temp_ee630f3a9ca74befa8553877c4ccc128.parquet
[2025-08-07 20:51:54,018][instanovo.utils.data_handler][INFO] - Verifying loaded data
[2025-08-07 20:52:38,552][__main__][INFO] - Validation path not specified, generating from training set.
[2025-08-07 20:52:40,233][__main__][INFO] - Data splits saved to /data/48/wuqian/fast/TipsNovo/model_save/splits.csv
[2025-08-07 20:52:40,233][__main__][INFO] - Checking for unknown residues in 128,000 rows.
[2025-08-07 20:52:40,244][__main__][WARNING] - Unsupported residues found in evaluation set! These rows will be dropped.
[2025-08-07 20:52:40,244][__main__][INFO] - New residues found: 
{'C+57.021', 'N+0.984', 'M+15.995'}
[2025-08-07 20:52:40,244][__main__][INFO] - Residues supported: 
{'K', 'Y', '[EOS]', 'C', 'Q', 'H', 'Q[UNIMOD:7]', 'S', 'A', 'M[UNIMOD:35]', 'N[UNIMOD:7]', 'T', 'Y[UNIMOD:21]', '[SOS]', 'F', 'S[UNIMOD:21]', 'R', 'G', 'N', 'W', 'P', '[UNIMOD:5]', 'M', 'V', 'C[UNIMOD:4]', 'D', '[PAD]', 'T[UNIMOD:21]', 'E', '[UNIMOD:1]', 'L', '[UNIMOD:385]', 'I'}
[2025-08-07 20:52:42,672][__main__][WARNING] - 18,000 (18.56%) training rows dropped.
[2025-08-07 20:52:42,672][__main__][WARNING] - 7,000 (22.58%) validation rows dropped.
[2025-08-07 20:52:45,853][__main__][INFO] - Data loaded: 79,000 training samples; 24,000 validation samples
[2025-08-07 20:52:45,863][__main__][INFO] - Checking if any validation set overlaps with training set...
[2025-08-07 20:52:45,863][__main__][INFO] - No data leakage!
[2025-08-07 20:52:45,864][__main__][INFO] - Model checkpointing every 0.19 epochs.
[2025-08-07 20:52:45,864][__main__][INFO] - Updates per epoch: 2,469, step_scale=1.0
[2025-08-07 20:52:54,140][__main__][INFO] - Sample batch:
[2025-08-07 20:52:54,140][__main__][INFO] -  - spectra.shape=torch.Size([32, 200, 2])
[2025-08-07 20:52:54,140][__main__][INFO] -  - precursors.shape=torch.Size([32, 3])
[2025-08-07 20:52:54,140][__main__][INFO] -  - spectra_mask.shape=torch.Size([32, 200])
[2025-08-07 20:52:54,140][__main__][INFO] -  - peptides.shape=torch.Size([32, 41])
[2025-08-07 20:52:54,140][__main__][INFO] -  - peptides_mask.shape=torch.Size([32, 41])
[2025-08-07 20:52:54,301][__main__][INFO] - Model loaded with 94,619,169 parameters
[2025-08-07 20:52:54,301][__main__][INFO] - Test forward pass:
[2025-08-07 20:52:55,781][__main__][INFO] -  - y.shape=torch.Size([32, 42, 33])
[2025-08-07 20:52:56,967][__main__][INFO] - Model saving enabled
[2025-08-07 20:52:56,967][__main__][INFO] - Saving every 480 training steps to /data/48/wuqian/fast/TipsNovo/model_save
[2025-08-07 20:52:56,967][__main__][INFO] - Initializing Pytorch Lightning trainer.
[2025-08-07 20:52:56,975][__main__][INFO] - InstaNovo training started.
[2025-08-07 20:54:47,024][__main__][INFO] - [VALIDATION] [Epoch 00/00] Starting validation.
[2025-08-07 20:55:03,727][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000050] [Batch 00050/01235] [00:00:08/00:03:16, 0.166s/it]: train_loss_raw=2.3216, running_loss=3.2356, LR=0.000102
[2025-08-07 20:55:12,012][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000100] [Batch 00100/01235] [00:00:16/00:03:07, 0.166s/it]: train_loss_raw=1.0348, running_loss=2.5905, LR=0.000206
[2025-08-07 20:55:20,358][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000150] [Batch 00150/01235] [00:00:24/00:03:00, 0.166s/it]: train_loss_raw=0.1897, running_loss=1.7074, LR=0.000310
[2025-08-07 20:55:28,492][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000200] [Batch 00200/01235] [00:00:33/00:02:50, 0.165s/it]: train_loss_raw=0.9245, running_loss=1.1417, LR=0.000415
[2025-08-07 20:55:36,865][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000250] [Batch 00250/01235] [00:00:41/00:02:43, 0.166s/it]: train_loss_raw=0.1285, running_loss=0.8777, LR=0.000519
[2025-08-07 20:55:45,176][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000300] [Batch 00300/01235] [00:00:49/00:02:34, 0.166s/it]: train_loss_raw=0.0725, running_loss=0.5713, LR=0.000623
[2025-08-07 20:55:53,460][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000350] [Batch 00350/01235] [00:00:58/00:02:26, 0.166s/it]: train_loss_raw=0.1876, running_loss=0.3782, LR=0.000727
[2025-08-07 20:56:01,776][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000400] [Batch 00400/01235] [00:01:06/00:02:18, 0.166s/it]: train_loss_raw=0.1129, running_loss=0.2807, LR=0.000831
[2025-08-07 20:56:10,134][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000450] [Batch 00450/01235] [00:01:14/00:02:10, 0.166s/it]: train_loss_raw=0.3617, running_loss=0.2277, LR=0.000935
[2025-08-07 20:56:22,020][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000500] [Batch 00500/01235] [00:01:26/00:02:07, 0.173s/it]: train_loss_raw=2.7323, running_loss=1.3245, LR=0.001000
[2025-08-07 20:56:30,378][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000550] [Batch 00550/01235] [00:01:34/00:01:58, 0.173s/it]: train_loss_raw=2.0121, running_loss=1.7140, LR=0.001000
[2025-08-07 20:56:38,617][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000600] [Batch 00600/01235] [00:01:43/00:01:49, 0.172s/it]: train_loss_raw=2.0543, running_loss=1.8429, LR=0.001000
[2025-08-07 20:56:46,965][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000650] [Batch 00650/01235] [00:01:51/00:01:40, 0.172s/it]: train_loss_raw=2.0178, running_loss=1.9149, LR=0.001000
[2025-08-07 20:56:55,239][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000700] [Batch 00700/01235] [00:01:59/00:01:31, 0.171s/it]: train_loss_raw=1.9938, running_loss=1.9540, LR=0.001000
[2025-08-07 20:57:03,549][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000750] [Batch 00750/01235] [00:02:08/00:01:22, 0.171s/it]: train_loss_raw=1.9685, running_loss=1.9866, LR=0.001000
[2025-08-07 20:57:11,849][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000800] [Batch 00800/01235] [00:02:16/00:01:14, 0.171s/it]: train_loss_raw=1.9890, running_loss=1.9922, LR=0.001000
[2025-08-07 20:57:20,208][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000850] [Batch 00850/01235] [00:02:24/00:01:05, 0.170s/it]: train_loss_raw=1.9781, running_loss=1.9967, LR=0.001000
[2025-08-07 20:57:28,643][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000900] [Batch 00900/01235] [00:02:33/00:00:57, 0.170s/it]: train_loss_raw=2.0012, running_loss=1.9931, LR=0.001000
[2025-08-07 20:57:36,912][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 000950] [Batch 00950/01235] [00:02:41/00:00:48, 0.170s/it]: train_loss_raw=1.9546, running_loss=1.9850, LR=0.001000
[2025-08-07 20:57:48,561][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 001000] [Batch 01000/01235] [00:02:53/00:00:40, 0.173s/it]: train_loss_raw=1.9162, running_loss=1.9601, LR=0.001000
[2025-08-07 20:57:56,549][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 001050] [Batch 01050/01235] [00:03:01/00:00:31, 0.172s/it]: train_loss_raw=1.8356, running_loss=1.9287, LR=0.001000
[2025-08-07 20:58:04,671][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 001100] [Batch 01100/01235] [00:03:09/00:00:23, 0.172s/it]: train_loss_raw=1.7249, running_loss=1.8705, LR=0.001000
[2025-08-07 20:58:12,891][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 001150] [Batch 01150/01235] [00:03:17/00:00:14, 0.172s/it]: train_loss_raw=1.7169, running_loss=1.8004, LR=0.001000
[2025-08-07 20:58:21,229][__main__][INFO] - [TRAIN] [Epoch 00/00 Step 001200] [Batch 01200/01235] [00:03:25/00:00:06, 0.171s/it]: train_loss_raw=1.5519, running_loss=1.7430, LR=0.001000
[2025-08-07 20:58:27,174][__main__][INFO] - [VALIDATION] [Epoch 00/00] Starting validation.
[2025-08-07 20:59:02,517][__main__][INFO] - [VALIDATION] [Epoch 00/00 Step 001236] [Batch 00049/00375] [00:00:35/00:03:49, 0.707s/it]
[2025-08-07 20:59:45,919][__main__][INFO] - [VALIDATION] [Epoch 00/00 Step 001236] [Batch 00099/00375] [00:01:18/00:03:36, 0.787s/it]
[2025-08-07 21:00:31,258][__main__][INFO] - [VALIDATION] [Epoch 00/00 Step 001236] [Batch 00149/00375] [00:02:04/00:03:06, 0.827s/it]
[2025-08-07 21:01:16,725][__main__][INFO] - [VALIDATION] [Epoch 00/00 Step 001236] [Batch 00199/00375] [00:02:49/00:02:28, 0.848s/it]
[2025-08-07 21:01:59,016][__main__][INFO] - [VALIDATION] [Epoch 00/00 Step 001236] [Batch 00249/00375] [00:03:31/00:01:45, 0.847s/it]
[2025-08-07 21:02:42,048][__main__][INFO] - [VALIDATION] [Epoch 00/00 Step 001236] [Batch 00299/00375] [00:04:14/00:01:03, 0.850s/it]
[2025-08-07 21:03:25,708][__main__][INFO] - [VALIDATION] [Epoch 00/00 Step 001236] [Batch 00349/00375] [00:04:58/00:00:21, 0.853s/it]
[2025-08-07 21:03:56,154][__main__][INFO] - [VALIDATION] [Epoch 00/00] train_loss=1.71453, valid_loss=7.90936
[2025-08-07 21:03:56,154][__main__][INFO] - [VALIDATION] [Epoch 00/00] Metrics:
[2025-08-07 21:03:56,154][__main__][INFO] - [VALIDATION] [Epoch 00/00] - aa_er      0.888
[2025-08-07 21:03:56,154][__main__][INFO] - [VALIDATION] [Epoch 00/00] - aa_prec    0.040
[2025-08-07 21:03:56,154][__main__][INFO] - [VALIDATION] [Epoch 00/00] - aa_recall  0.032
[2025-08-07 21:03:56,154][__main__][INFO] - [VALIDATION] [Epoch 00/00] - pep_recall 0.000
[2025-08-07 21:03:56,161][__main__][INFO] - [TRAIN] [Epoch 00/00] Epoch complete, total time 00:09:00, remaining time 00:00:00, 00:09:00 per epoch
[2025-08-07 21:03:57,334][__main__][INFO] - InstaNovo training finished.
