[2025-08-26 18:55:35,737][__main__][INFO] - Initializing training.
[2025-08-26 18:55:35,737][__main__][INFO] - Python version: 3.10.18 | packaged by conda-forge | (main, Jun  4 2025, 14:45:41) [GCC 13.3.0]
[2025-08-26 18:55:35,737][__main__][INFO] - Torch version: 2.4.1+cu121
[2025-08-26 18:55:35,737][__main__][INFO] - CUDA version: 12.1
[2025-08-26 18:55:35,741][__main__][INFO] - Imported hydra config:
train_path: /data/48/wuqian/Proteometools/part1/parquet/1461_trainValid_split/train/*.parquet
profiler: false
epochs: 30
num_sanity_val_steps: 10
console_logging_steps: 50
tensorboard_logging_steps: 500
report_to: null
run_name: 1461high_trainValid_splited
dim_model: 768
n_head: 16
dim_feedforward: 1024
n_layers: 9
dropout: 0.1
use_flash_attention: false
conv_peak_encoder: false
n_peaks: 200
min_mz: 50.0
max_mz: 2500.0
min_intensity: 0.01
remove_precursor_tol: 2.0
max_charge: 10
precursor_mass_tol: 50
isotope_error_range:
- 0
- 1
predict_batch_size: 128
max_length: 40
tb_summarywriter: /data/48/wuqian/fast/TipsNovo/log
warmup_iters: 480
max_iters: 3000000
learning_rate: 0.0001
train_batch_size: 192
grad_accumulation: 1
weight_decay: 1.0e-05
gradient_clip_val: 10.0
n_beams: 5
compile_model: true
device: auto
n_gpu: 1
fp16: true
train_subset: 1
valid_subset_of_train: 0.01
valid_subset: 1
val_check_interval: 1.0
lazy_loading: true
max_shard_size: 1000000
preshuffle_shards: false
perform_data_checks: true
validate_precursor_mass: false
verbose_loading: true
model_save_folder_path: /data/48/wuqian/fast/TipsNovo/model_save/
save_model: true
save_weights_only: false
ckpt_interval: 2000
train_from_scratch: true
resume_checkpoint: null
residues:
  G: 57.021464
  A: 71.037114
  S: 87.032028
  P: 97.052764
  V: 99.068414
  T: 101.04767
  C: 103.009185
  L: 113.084064
  I: 113.084064
  'N': 114.042927
  D: 115.026943
  Q: 128.058578
  K: 128.094963
  E: 129.042593
  M: 131.040485
  H: 137.058912
  F: 147.068414
  R: 156.101111
  'Y': 163.063329
  W: 186.079313
  M[UNIMOD:35]: 147.0354
  C[UNIMOD:4]: 160.030649
  N[UNIMOD:7]: 115.026943
  Q[UNIMOD:7]: 129.042594
  S[UNIMOD:21]: 166.998028
  T[UNIMOD:21]: 181.01367
  Y[UNIMOD:21]: 243.029329
  '[UNIMOD:1]': 42.010565
  '[UNIMOD:5]': 43.005814
  '[UNIMOD:385]': -17.026549

[2025-08-26 18:55:35,746][__main__][INFO] - Starting transformer training
[2025-08-26 18:55:35,746][__main__][INFO] - Vocab: {0: '[PAD]', 1: '[SOS]', 2: '[EOS]', 3: 'G', 4: 'A', 5: 'S', 6: 'P', 7: 'V', 8: 'T', 9: 'C', 10: 'L', 11: 'I', 12: 'N', 13: 'D', 14: 'Q', 15: 'K', 16: 'E', 17: 'M', 18: 'H', 19: 'F', 20: 'R', 21: 'Y', 22: 'W', 23: 'M[UNIMOD:35]', 24: 'C[UNIMOD:4]', 25: 'N[UNIMOD:7]', 26: 'Q[UNIMOD:7]', 27: 'S[UNIMOD:21]', 28: 'T[UNIMOD:21]', 29: 'Y[UNIMOD:21]', 30: '[UNIMOD:1]', 31: '[UNIMOD:5]', 32: '[UNIMOD:385]'}
[2025-08-26 18:55:35,746][__main__][INFO] - Loading data
[2025-08-26 18:55:45,468][instanovo.utils.data_handler][INFO] - Verifying loaded data
[2025-08-26 18:55:55,035][__main__][INFO] - Validation path not specified, generating from training set.
[2025-08-26 18:56:53,742][__main__][INFO] - Data splits saved to /data/48/wuqian/fast/TipsNovo/model_save/splits.csv
[2025-08-26 18:56:53,743][__main__][INFO] - Checking for unknown residues in 1,182,694 rows.
[2025-08-26 18:56:56,232][__main__][WARNING] - Unsupported residues found in evaluation set! These rows will be dropped.
[2025-08-26 18:56:56,233][__main__][INFO] - New residues found: 
{'O'}
[2025-08-26 18:56:56,233][__main__][INFO] - Residues supported: 
{'V', 'S', 'L', 'Q', 'F', 'A', 'P', 'N', '[UNIMOD:1]', 'Y[UNIMOD:21]', 'M', 'Q[UNIMOD:7]', 'G', 'C', '[UNIMOD:5]', '[PAD]', 'E', '[EOS]', 'I', 'S[UNIMOD:21]', '[UNIMOD:385]', 'R', 'K', 'T', 'M[UNIMOD:35]', 'C[UNIMOD:4]', 'T[UNIMOD:21]', 'Y', '[SOS]', 'W', 'N[UNIMOD:7]', 'H', 'D'}
[2025-08-26 18:58:02,561][__main__][WARNING] - 1 (0.00%) training rows dropped.
[2025-08-26 18:58:02,561][__main__][WARNING] - 0 (0.00%) validation rows dropped.
[2025-08-26 18:59:11,782][__main__][INFO] - Data loaded: 1,171,830 training samples; 10,863 validation samples
[2025-08-26 18:59:12,225][__main__][INFO] - Checking if any validation set overlaps with training set...
[2025-08-26 18:59:12,267][__main__][INFO] - No data leakage!
[2025-08-26 18:59:12,267][__main__][INFO] - Model checkpointing every 0.33 epochs.
[2025-08-26 18:59:12,268][__main__][INFO] - Updates per epoch: 6,104, step_scale=0.16666666666666666
[2025-08-26 18:59:31,490][__main__][INFO] - Sample batch:
[2025-08-26 18:59:31,490][__main__][INFO] -  - spectra.shape=torch.Size([192, 200, 2])
[2025-08-26 18:59:31,490][__main__][INFO] -  - precursors.shape=torch.Size([192, 3])
[2025-08-26 18:59:31,490][__main__][INFO] -  - spectra_mask.shape=torch.Size([192, 200])
[2025-08-26 18:59:31,490][__main__][INFO] -  - peptides.shape=torch.Size([192, 41])
[2025-08-26 18:59:31,490][__main__][INFO] -  - peptides_mask.shape=torch.Size([192, 41])
[2025-08-26 18:59:31,616][__main__][INFO] - Model loaded with 94,619,169 parameters
[2025-08-26 18:59:31,616][__main__][INFO] - Test forward pass:
[2025-08-26 18:59:41,144][__main__][INFO] -  - y.shape=torch.Size([192, 42, 33])
[2025-08-26 18:59:42,417][__main__][INFO] - Model saving enabled
[2025-08-26 18:59:42,418][__main__][INFO] - Saving every 2000 training steps to /data/48/wuqian/fast/TipsNovo/model_save/
[2025-08-26 18:59:42,418][__main__][INFO] - Initializing Pytorch Lightning trainer.
[2025-08-26 18:59:42,429][__main__][INFO] - InstaNovo training started.
[2025-08-26 19:04:02,806][__main__][INFO] - [VALIDATION] [Epoch 00/29] Starting validation.
[2025-08-26 19:04:22,367][__main__][INFO] - [VALIDATION] [Epoch 00/29 Step 000001] [Batch 00007/00043] [00:00:19/00:01:25, 2.445s/it]
[2025-08-26 19:04:31,556][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000008] [Batch 00008/03052] [00:00:05/00:37:26, 0.738s/it]: train_loss_raw=3.4860, running_loss=3.6071, LR=0.000001
[2025-08-26 19:04:37,624][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000016] [Batch 00016/03052] [00:00:11/00:37:51, 0.748s/it]: train_loss_raw=3.2124, running_loss=3.5856, LR=0.000003
[2025-08-26 19:04:43,730][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000024] [Batch 00024/03052] [00:00:18/00:38:00, 0.753s/it]: train_loss_raw=3.0381, running_loss=3.5481, LR=0.000005
[2025-08-26 19:04:49,920][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000032] [Batch 00032/03052] [00:00:24/00:38:10, 0.758s/it]: train_loss_raw=2.9948, running_loss=3.5073, LR=0.000006
[2025-08-26 19:04:56,047][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000040] [Batch 00040/03052] [00:00:30/00:38:08, 0.760s/it]: train_loss_raw=2.9688, running_loss=3.4666, LR=0.000008
[2025-08-26 19:05:02,024][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000048] [Batch 00048/03052] [00:00:36/00:37:56, 0.758s/it]: train_loss_raw=2.9323, running_loss=3.4269, LR=0.000010
[2025-08-26 19:05:08,011][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000056] [Batch 00056/03052] [00:00:42/00:37:46, 0.756s/it]: train_loss_raw=2.8994, running_loss=3.3872, LR=0.000011
[2025-08-26 19:05:13,900][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000064] [Batch 00064/03052] [00:00:48/00:37:32, 0.754s/it]: train_loss_raw=2.8106, running_loss=3.3455, LR=0.000013
[2025-08-26 19:05:19,789][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000072] [Batch 00072/03052] [00:00:54/00:37:20, 0.752s/it]: train_loss_raw=2.7674, running_loss=3.3015, LR=0.000015
[2025-08-26 19:05:25,636][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000080] [Batch 00080/03052] [00:00:59/00:37:08, 0.750s/it]: train_loss_raw=2.7568, running_loss=3.2586, LR=0.000016
[2025-08-26 19:05:31,571][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000088] [Batch 00088/03052] [00:01:05/00:37:00, 0.749s/it]: train_loss_raw=2.7162, running_loss=3.2175, LR=0.000018
