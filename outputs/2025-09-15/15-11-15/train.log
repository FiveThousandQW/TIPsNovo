[2025-09-15 15:11:15,456][__main__][INFO] - Initializing training.
[2025-09-15 15:11:15,456][__main__][INFO] - Python version: 3.10.15 | packaged by conda-forge | (main, Oct 16 2024, 01:24:24) [GCC 13.3.0]
[2025-09-15 15:11:15,456][__main__][INFO] - Torch version: 2.4.1+cu121
[2025-09-15 15:11:15,456][__main__][INFO] - CUDA version: 12.1
[2025-09-15 15:11:15,460][__main__][INFO] - Imported hydra config:
use_readyData: true
save_readyData: false
train_readyData: /data/48/wuqian/fast/TipsNovo/data/readyData/systemMHC_train112W_anno.pt
test_readyData: /data/48/wuqian/fast/TipsNovo/data/readyData/systemMHC_valid7w.parquet
train_path: /data/48/wuqian/fast/TipsNovo/data/systemMHC_train112W_anno.parquet
valid_path: /data/48/wuqian/fast/TipsNovo/data/systemMHC_valid7w.parquet
profiler: false
epochs: 30
num_sanity_val_steps: 10
console_logging_steps: 50
tensorboard_logging_steps: 500
report_to: null
run_name: SystemMHC_TrainValid_split_noLazy
dim_model: 768
n_head: 16
dim_feedforward: 1024
n_layers: 9
dropout: 0.1
use_flash_attention: false
conv_peak_encoder: false
n_peaks: 200
min_mz: 50.0
max_mz: 2500.0
min_intensity: 0.01
remove_precursor_tol: 2.0
max_charge: 10
precursor_mass_tol: 50
isotope_error_range:
- 0
- 1
predict_batch_size: 128
max_length: 40
tb_summarywriter: /data/48/wuqian/fast/TipsNovo/log
warmup_iters: 480
max_iters: 3000000
learning_rate: 0.0001
train_batch_size: 160
grad_accumulation: 1
weight_decay: 1.0e-05
gradient_clip_val: 10.0
n_beams: 5
compile_model: true
device: auto
n_gpu: 1
fp16: true
train_subset: 1
valid_subset: 1
val_check_interval: 1.0
lazy_loading: false
max_shard_size: 1000000
preshuffle_shards: false
perform_data_checks: true
validate_precursor_mass: false
verbose_loading: true
model_save_folder_path: /data/48/wuqian/fast/TipsNovo/model_save/
save_model: true
save_weights_only: false
ckpt_interval: 6000
train_from_scratch: true
resume_checkpoint: /data/48/wuqian/fast/TipsNovo/model_save/epoch_0-step_6000.ckpt
residues:
  G: 57.021464
  A: 71.037114
  S: 87.032028
  P: 97.052764
  V: 99.068414
  T: 101.04767
  C: 103.009185
  L: 113.084064
  I: 113.084064
  'N': 114.042927
  D: 115.026943
  Q: 128.058578
  K: 128.094963
  E: 129.042593
  M: 131.040485
  H: 137.058912
  F: 147.068414
  R: 156.101111
  'Y': 163.063329
  W: 186.079313
  M[147]: 147.0354
  P[113]: 113.047679
  W[202]: 202.074228
  E[111]: 111.032028
  Q[111]: 111.032029

[2025-09-15 15:11:15,464][__main__][INFO] - Starting transformer training
[2025-09-15 15:11:15,465][__main__][INFO] - Vocab: {0: '[PAD]', 1: '[SOS]', 2: '[EOS]', 3: 'G', 4: 'A', 5: 'S', 6: 'P', 7: 'V', 8: 'T', 9: 'C', 10: 'L', 11: 'I', 12: 'N', 13: 'D', 14: 'Q', 15: 'K', 16: 'E', 17: 'M', 18: 'H', 19: 'F', 20: 'R', 21: 'Y', 22: 'W', 23: 'M[147]', 24: 'P[113]', 25: 'W[202]', 26: 'E[111]', 27: 'Q[111]'}
[2025-09-15 15:11:15,465][__main__][INFO] - Loading data
[2025-09-15 15:11:15,465][__main__][INFO] - Using ready data
[2025-09-15 15:12:25,924][__main__][INFO] - Updates per epoch: 6,440, step_scale=0.2
[2025-09-15 15:12:27,115][__main__][INFO] - Sample batch:
[2025-09-15 15:12:27,115][__main__][INFO] -  - spectra.shape=torch.Size([160, 200, 2])
[2025-09-15 15:12:27,115][__main__][INFO] -  - precursors.shape=torch.Size([160, 3])
[2025-09-15 15:12:27,115][__main__][INFO] -  - spectra_mask.shape=torch.Size([160, 200])
[2025-09-15 15:12:27,115][__main__][INFO] -  - peptides.shape=torch.Size([160, 41])
[2025-09-15 15:12:27,115][__main__][INFO] -  - peptides_mask.shape=torch.Size([160, 41])
[2025-09-15 15:12:27,340][__main__][INFO] - Model loaded with 94,611,484 parameters
[2025-09-15 15:12:27,340][__main__][INFO] - Test forward pass:
[2025-09-15 15:13:17,047][__main__][INFO] -  - y.shape=torch.Size([160, 42, 28])
[2025-09-15 15:13:17,544][__main__][INFO] - Model saving enabled
[2025-09-15 15:13:17,544][__main__][INFO] - Saving every 6000 training steps to /data/48/wuqian/fast/TipsNovo/model_save/
[2025-09-15 15:13:17,544][__main__][INFO] - Initializing Pytorch Lightning trainer.
[2025-09-15 15:13:17,555][__main__][INFO] - InstaNovo training started.
[2025-09-15 15:13:18,310][__main__][INFO] - [VALIDATION] [Epoch 00/29] Starting validation.
[2025-09-15 15:13:30,416][__main__][INFO] - [VALIDATION] [Epoch 00/29 Step 000001] [Batch 00009/00503] [00:00:12/00:09:56, 1.211s/it]
[2025-09-15 15:13:35,355][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000010] [Batch 00010/06440] [00:00:04/00:44:40, 0.417s/it]: train_loss_raw=3.3115, running_loss=3.4984, LR=0.000002
[2025-09-15 15:13:39,654][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000020] [Batch 00020/06440] [00:00:08/00:45:18, 0.423s/it]: train_loss_raw=3.0282, running_loss=3.4650, LR=0.000004
[2025-09-15 15:13:43,952][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000030] [Batch 00030/06440] [00:00:12/00:45:27, 0.426s/it]: train_loss_raw=2.9596, running_loss=3.4200, LR=0.000006
[2025-09-15 15:13:48,264][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000040] [Batch 00040/06440] [00:00:17/00:45:32, 0.427s/it]: train_loss_raw=2.9355, running_loss=3.3745, LR=0.000008
[2025-09-15 15:13:52,561][__main__][INFO] - [TRAIN] [Epoch 00/29 Step 000050] [Batch 00050/06440] [00:00:21/00:45:31, 0.428s/it]: train_loss_raw=2.9135, running_loss=3.3321, LR=0.000010
